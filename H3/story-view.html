<!-- story-view.html  à¹à¸ªà¸”à¸‡à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”à¸‚à¸­à¸‡à¸ªà¸•à¸­à¸£à¸µà¹ˆà¹à¸šà¸šà¹€à¸•à¹‡à¸¡ à¸à¸£à¹‰à¸­à¸¡à¸£à¸¹à¸›à¸›à¸ à¹€à¸™à¸·à¹‰à¸­à¸«à¸² à¹à¸¥à¸°à¹à¸—à¹‡à¸-->
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Gift Finder | Story Details</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="stylesheet" href="assets/css/global.css" />
  <link rel="stylesheet" href="assets/css/stories.css" />

  <link rel="stylesheet" href="assets/css/story-view.css">
</head>

<body>
<!-- à¸£à¸­à¹à¸à¹‰ -->
  <header class="navbar">
    <div class="container nav-content">
      <a class="logo" href="index.html">ğŸ Gift Finder</a>
    </div>
  </header>
<!-- à¸£à¸­à¹à¸à¹‰ -->
<div class="story-top-bar"> <!-- à¹à¸–à¸šà¸”à¹‰à¸²à¸™à¸šà¸™ à¸¡à¸µà¸¥à¸´à¸‡à¸à¹Œà¸à¸¥à¸±à¸šà¹„à¸›à¸«à¸™à¹‰à¸² stories -->
    <a href="stories.html" class="back-link">â† Back to Stories</a>
  </div>

<!-- à¸à¸¥à¹ˆà¸­à¸‡à¹ƒà¸«à¸à¹ˆà¸ªà¸¸à¸” -->
  <main class="story-view-container">

<!-- Complete! -->
    <!-- à¸à¸¥à¹ˆà¸­à¸‡à¸¢à¹ˆà¸­à¸¢à¸‹à¹‰à¸²à¸¢ -->
    <article class="story-card" data-story-id="story-001" data-likes-base="18">
      <!-- à¸£à¸¹à¸›à¸›à¸à¹ƒà¸«à¸à¹ˆà¸”à¹‰à¸²à¸™à¸šà¸™ -->
      <figure class="story-cover">
        <img src="uploads/covers/sample-cover.jpg" alt="Story cover">
      </figure>

      <h2 class="story-title">How I Found the Perfect Giftttttttttttttttttttttttttttttttttttttttttttttttttttttttttttt</h2>
      <!-- à¹à¸–à¸§à¸œà¸¹à¹‰à¹€à¸‚à¸µà¸¢à¸™ / à¸›à¸¸à¹ˆà¸¡à¸à¸” -->
      <section class="actoin-row">
        <div class="story-meta-left">
          <span class="story-author">by <strong><a href="stories.php?tag=birthday" >Naizzz </a></strong></span>
          <span class="story-date">27 November 2018</span>
        </div>

        <div class="story-actions">
          <!-- à¸›à¸¸à¹ˆà¸¡ Like à¸¡à¸µà¸•à¸±à¸§à¹€à¸¥à¸‚ -->
          <button class="pill-btn js-like-btn">
            <span class="pill-count js-like-count">18</span>
            <span class="pill-icon js-like-icon">â™¡</span>
          </button>

          <!-- à¸›à¸¸à¹ˆà¸¡ Save -->
          <button class="pill-btn js-save-btn">
            <span class="pill-icon js-save-icon">â˜†</span> 
          </button>

          <!-- à¸›à¸¸à¹ˆà¸¡ Share -->
          <button class="pill-btn js-share-btn">
            <span class="pill-icon">â¤´</span>
            <span class="pill-label">Share</span>
          </button>
        </div>
      </section>

      <!-- à¹€à¸™à¸·à¹‰à¸­à¹€à¸£à¸·à¹ˆà¸­à¸‡ -->
      <section class="story-body">
        <p>
          I always struggle to find gifts, but this time I tried using our Gift Finder
          filters to narrow down budget, interest, and personalityâ€¦
        </p>
        <p>
          First, I listed three things my friend really loves: coffee, journaling,
          and cute stationery. Then yyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyy i hate you so much yyyyyyyyyyyyyyyy yyyyyyyyyyyyyyyyyy
        </p>
        <p>
          I always struggle to find gifts, but this time I tried using our Gift Finder
          filters to narrow down budget, interest, and personalityâ€¦
        </p>
        <p>
          First, I listed three things my friend really loves: coffee, journaling,First, I listed three things my friend really loves: coffee, journaling,
          and cute stationery. Then yyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyy i hate you so much yyyyyyyyyyyyyyyy yyyyyyyyyyyyyyyyyyFirst, I listed three things my friend really loves: coffee, journaling,
         
        </p>

        <!--  and cute stationery. Then yyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyy i hate you so much yyyyyyyyyyyyyyyy yyyyyyyyyyyyyyyyyyFirst, I listed three things my friend really loves: coffee, journaling,
          and cute stationery. Then yyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyy i hate you so much yyyyyyyyyyyyyyyy yyyyyyyyyyyyyyyyyyFirst, I listed three things my friend really loves: coffee, journaling,
          and cute stationery. Then yyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyy i hate you so much yyyyyyyyyyyyyyyy yyyyyyyyyyyyyyyyyyFirst, I listed three things my friend really loves: coffee, journaling,
          and cute stationery. Then yyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyy i hate you so much yyyyyyyyyyyyyyyy yyyyyyyyyyyyyyyyyyFirst, I listed three things my friend really loves: coffee, journaling,
          and cute stationery. Then yyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyy i hate you so much yyyyyyyyyyyyyyyy yyyyyyyyyyyyyyyyyyFirst, I listed three things my friend really loves: coffee, journaling,
          and cute stationery. Then yyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyy i hate you so much yyyyyyyyyyyyyyyy yyyyyyyyyyyyyyyyyyFirst, I listed three things my friend really loves: coffee, journaling,
          and cute stationery. Then yyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyy i hate you so much yyyyyyyyyyyyyyyy yyyyyyyyyyyyyyyyyyFirst, I listed three things my friend really loves: coffee, journaling,
          and cute stationery. Then yyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyy i hate you so much yyyyyyyyyyyyyyyy yyyyyyyyyyyyyyyyyyFirst, I listed three things my friend really loves: coffee, journaling,
          and cute stationery. Then yyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyy i hate you so much yyyyyyyyyyyyyyyy yyyyyyyyyyyyyyyyyyFirst, I listed three things my friend really loves: coffee, journaling,
          and cute stationery. Then yyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyy i hate you so much yyyyyyyyyyyyyyyy yyyyyyyyyyyyyyyyyyFirst, I listed three things my friend really loves: coffee, journaling,
          and cute stationery. Then yyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyy i hate you so much yyyyyyyyyyyyyyyy yyyyyyyyyyyyyyyyyyFirst, I listed three things my friend really loves: coffee, journaling,
          and cute stationery. Then yyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyy i hate you so much yyyyyyyyyyyyyyyy yyyyyyyyyyyyyyyyyyFirst, I listed three things my friend really loves: coffee, journaling,
          and cute stationery. Then yyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyy i hate you so much yyyyyyyyyyyyyyyy yyyyyyyyyyyyyyyyyy
          and cute stationery. Then yyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyy i hate you so much yyyyyyyyyyyyyyyy yyyyyyyyyyyyyyyyyy -->
<!-- à¹€à¸§à¸¥à¸²à¹ƒà¸Šà¹‰à¸ˆà¸£à¸´à¸‡ à¹ƒà¸«à¹‰ echo à¸ˆà¸²à¸ PHP + à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™ render_story_body à¸—à¸µà¹ˆà¹€à¸£à¸²à¹€à¸„à¸¢à¸„à¸¸à¸¢à¸à¸±à¸™ -->
      </section>

      <!-- à¹à¸—à¹‡à¸à¸”à¹‰à¸²à¸™à¸¥à¹ˆà¸²à¸‡ -->
      <section class="story-tags">
        <div class="tags-label">Tags:</div>
        <div class="tags-list">
          <!-- à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡ tag à¸¢à¸­à¸”à¸™à¸´à¸¢à¸¡ -->
          <a href="stories.php?tag=birthday" class="tag-chip">#birthday</a>
          <a href="stories.php?tag=friend" class="tag-chip">#friend</a>
          <a href="stories.php?tag=low%20budget" class="tag-chip">#low&nbsp;budget</a>
          <a href="stories.php?tag=stationery" class="tag-chip">#stationery</a>
          <a href="stories.php?tag=surprise" class="tag-chip">#surprise</a>
          <a href="stories.php?tag=birthday" class="tag-chip">#birthday</a>
          <a href="stories.php?tag=friend" class="tag-chip">#friend</a>
          <a href="stories.php?tag=low%20budget" class="tag-chip">#low&nbsp;budget</a>
          <a href="stories.php?tag=stationery" class="tag-chip">#stationery</a>
          <a href="stories.php?tag=surprise" class="tag-chip">#surprise</a>
        </div>
      </section>
    </article>

    <!-- right-aside à¹à¸™à¸°à¸™à¸³ story à¸­à¸·à¹ˆà¸™ -->
    <aside class="right-aside">
      <h3>More stories</h3>

      <div id="suggestions-grid" class="suggestions-grid">
        <!-- JS à¸ˆà¸°à¹€à¸•à¸´à¸¡ popular stories à¹à¸šà¸šà¸«à¸™à¹‰à¸² index -->
      </div>
       
    </aside>
  </main>
  
<!-- à¸£à¸­à¹à¸à¹‰ -->
<!-- à¸”à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ mock POSTS à¸ˆà¸²à¸ data.js à¹à¸šà¸šà¹€à¸”à¸µà¸¢à¸§à¸à¸±à¸šà¸«à¸™à¹‰à¸² index -->
  <script src="assets/js/data.js"></script>
  <script>
  document.addEventListener("DOMContentLoaded", () => {
    const container = document.getElementById("suggestions-grid");
    if (!container || typeof POSTS === "undefined") return;

    // à¹€à¸­à¸² 3 à¹€à¸£à¸·à¹ˆà¸­à¸‡à¹à¸£à¸à¹à¸šà¸šà¸«à¸™à¹‰à¸² index max  4 à¹€à¸£à¸·à¹ˆà¸­à¸‡ i dont know why.
    const popular = POSTS.slice(0, 4);

    container.innerHTML = popular
      .map(
        (p) => `
        <div class="popular-card">
          <a href="story-view.html" class="popular-card-link">
            <img src="${p.image}" alt="${p.title}">
            <!-- à¸¡à¸¸à¸¡à¸‹à¹‰à¸²à¸¢à¸šà¸™: à¹à¸ªà¸”à¸‡à¹„à¸¥à¸„à¹Œ --> 
            <div class="popular-like-badge">
              ${p.likes ?? 0} â¤
            </div>
            <div class="popular-card-title">${p.title}</div>
          </a> 
        </div>
      `
      )
      .join("");
  });
  </script>

<!-- à¸£à¸­à¹à¸à¹‰ -->
  <!-- JS like / save / share -->
  <script>
    const STORAGE_KEY = 'gf_story_actions';

    function loadStoryActions() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        return raw ? JSON.parse(raw) : {};
      } catch (e) {
        console.error('Cannot read story actions from storage', e);
        return {};
      }
    }

    function saveStoryActions(actions) {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(actions));
      } catch (e) {
        console.error('Cannot save story actions', e);
      }
    }

    function getStoryState(storyId) {
      const all = loadStoryActions();
      return all[storyId] || { liked: false, saved: false };
    }

    function setStoryState(storyId, newState) {
      const all = loadStoryActions();
      all[storyId] = newState;
      saveStoryActions(all);
    }

    function updateLikeUI(storyEl, state) {
  const likeBtn   = storyEl.querySelector('.js-like-btn');
  const likeIcon  = storyEl.querySelector('.js-like-icon');
  const likeCount = storyEl.querySelector('.js-like-count');

  if (!likeBtn) return;

  const baseLikes = parseInt(storyEl.getAttribute('data-likes-base') || '0', 10) || 0;
  const totalLikes = baseLikes + (state.liked ? 1 : 0);

  likeBtn.classList.toggle('is-active', state.liked);

  if (likeIcon)  likeIcon.textContent  = state.liked ? 'â¤' : 'â™¡';
  if (likeCount) likeCount.textContent = totalLikes;

  // âœ… à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™ tooltip à¸•à¸²à¸¡à¸ªà¸–à¸²à¸™à¸°
  likeBtn.title = state.liked ? 'Liked' : 'Like';
}

function updateSaveUI(storyEl, state) {
  const saveBtn  = storyEl.querySelector('.js-save-btn');
  const saveIcon = storyEl.querySelector('.js-save-icon');

  if (!saveBtn) return;

  saveBtn.classList.toggle('is-active', state.saved);

  if (saveIcon) saveIcon.textContent = state.saved ? 'â˜…' : 'â˜†';

  // âœ… tooltip à¸•à¸²à¸¡à¸ªà¸–à¸²à¸™à¸°
  saveBtn.title = state.saved ? 'Saved' : 'Save';
}

    document.addEventListener('DOMContentLoaded', function () {
      const storyEl = document.querySelector('.story-card');
      if (!storyEl) return;

      const storyId = storyEl.getAttribute('data-story-id');
      const likeBtn = storyEl.querySelector('.js-like-btn');
      const saveBtn = storyEl.querySelector('.js-save-btn');
      const shareBtn = storyEl.querySelector('.js-share-btn');

      const state = getStoryState(storyId);
      updateLikeUI(storyEl, state);
      updateSaveUI(storyEl, state);

      if (likeBtn) {
        likeBtn.addEventListener('click', () => {
          const current = getStoryState(storyId);
          const newState = { ...current, liked: !current.liked };
          setStoryState(storyId, newState);
          updateLikeUI(storyEl, newState);
        });
      }

      if (saveBtn) {
        saveBtn.addEventListener('click', () => {
          const current = getStoryState(storyId);
          const newState = { ...current, saved: !current.saved };
          setStoryState(storyId, newState);
          updateSaveUI(storyEl, newState);
        });
      }

      if (shareBtn) {
        shareBtn.addEventListener('click', async () => {
          const url = window.location.href;

          if (navigator.share) {
            try {
              await navigator.share({
                title: document.title,
                text: 'Check out this gift story!',
                url: url
              });
            } catch (_) {}
          } else if (navigator.clipboard) {
            try {
              await navigator.clipboard.writeText(url);
              alert('Copied link to clipboard!');
            } catch (e) {
              alert('Cannot copy link, please copy manually.');
            }
          } else {
            alert('Sharing is not supported on this browser.');
          }
        });
      }
    });
  </script>
</body>
</html>
